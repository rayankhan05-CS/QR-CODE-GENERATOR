
<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>QR CODE GENERATOR - Ultimate</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Playfair+Display:ital,wght@1,600&family=Oswald:wght@500&family=Roboto+Mono:wght@500;700&family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">

<script src="https://unpkg.com/qr-code-styling@1.6.0-rc.1/lib/qr-code-styling.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>

<style>
:root {
  /* THEME VARIABLES */
  --bg-app: #020617;
  --bg-panel: rgba(15, 23, 42, 0.85);
  --border: rgba(255, 255, 255, 0.08);
  --text-main: #f8fafc;
  --text-muted: #94a3b8;
  --input-bg: rgba(0, 0, 0, 0.3);
  --glass-shadow: 0 20px 40px -10px rgba(0,0,0,0.6);
  
  /* Brand Colors */
  --primary: #6366f1;
  --accent-gradient: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%);
  --radius: 14px;
}

[data-theme="light"] {
  --bg-app: #f1f5f9;
  --bg-panel: rgba(255, 255, 255, 0.9);
  --border: rgba(0, 0, 0, 0.08);
  --text-main: #0f172a;
  --text-muted: #64748b;
  --input-bg: rgba(255, 255, 255, 0.6);
  --glass-shadow: 0 20px 40px -10px rgba(0,0,0,0.1);
}

* { box-sizing: border-box; outline: none; }

body {
  margin: 0; font-family: 'Inter', sans-serif; min-height: 100vh;
  background-color: var(--bg-app);
  background-image: radial-gradient(circle at 15% 50%, rgba(99, 102, 241, 0.1) 0%, transparent 25%);
  color: var(--text-main);
  display: flex; justify-content: center; padding: 40px 20px;
  transition: background 0.3s ease, color 0.3s ease;
}

.app { width: 1200px; max-width: 100%; display: grid; grid-template-columns: 1fr 420px; gap: 32px; align-items: start; }

/* PANEL */
.panel {
  background: var(--bg-panel); backdrop-filter: blur(20px); border: 1px solid var(--border);
  padding: 32px; border-radius: 24px; box-shadow: var(--glass-shadow);
}

/* HEADER */
.brand { display: flex; align-items: center; gap: 12px; }
.brand .logo { width: 42px; height: 42px; background: var(--accent-gradient); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 800; font-size: 14px; box-shadow: 0 4px 12px rgba(99, 102, 241, 0.3); }
h2 { margin: 0; font-size: 18px; font-weight: 700; letter-spacing: -0.02em; color: var(--text-main); }

/* FORM */
label { display: block; font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; color: var(--text-muted); margin: 18px 0 8px; }
input, select, textarea { width: 100%; background: var(--input-bg); border: 1px solid var(--border); border-radius: var(--radius); padding: 12px 16px; color: var(--text-main); font-family: inherit; font-size: 14px; transition: all 0.2s; }
input:focus, select:focus, textarea:focus { border-color: var(--primary); box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2); }
textarea#text { background: rgba(99, 102, 241, 0.05); border-color: rgba(99, 102, 241, 0.3); }

input[type=color] { -webkit-appearance: none; height: 42px; padding: 0; cursor: pointer; background: transparent; }
input[type=color]::-webkit-color-swatch-wrapper { padding: 0; }
input[type=color]::-webkit-color-swatch { border: 1px solid var(--border); border-radius: var(--radius); }

.controls-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }
.row { display: flex; gap: 10px; align-items: center; }

/* BUTTONS */
button { font-family: inherit; font-size: 14px; font-weight: 600; cursor: pointer; border-radius: var(--radius); transition: all 0.2s; border:none; }
button.primary { width: 100%; padding: 14px; background: var(--accent-gradient); color: white; box-shadow: 0 4px 14px rgba(99, 102, 241, 0.3); }
button.primary:hover { transform: translateY(-1px); box-shadow: 0 6px 20px rgba(99, 102, 241, 0.4); }
button.ghost { width: 100%; padding: 12px; background: rgba(125,125,125,0.1); border: 1px solid var(--border); color: var(--text-muted); }
button.ghost:hover { background: rgba(125,125,125,0.2); color: var(--text-main); }
button.text-btn { padding: 6px 12px; font-size: 11px; text-transform: uppercase; letter-spacing: 1px; font-weight: 700; background:rgba(125,125,125,0.1); border:1px solid var(--border); color:var(--text-muted); border-radius:8px;}
button.icon-only { width: 40px; height: 40px; padding: 0; display: flex; align-items: center; justify-content: center; font-size: 16px; }

/* STYLE BUTTONS */
.visual-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; }
.style-btn { background: var(--input-bg); border: 1px solid var(--border); color: var(--text-muted); padding: 10px; border-radius: 10px; text-align: center; font-size: 11px; cursor: pointer; display: flex; flex-direction: column; align-items: center; gap: 4px; transition: 0.2s; }
.style-btn:hover { background: rgba(125,125,125,0.15); color: var(--text-main); }
.style-btn.active { background: rgba(99, 102, 241, 0.15); border-color: var(--primary); color: var(--primary); box-shadow: 0 0 0 1px var(--primary); }
.style-btn.btn-neon.active { border-color: #39ff14; color: #39ff14; }
.style-btn.btn-holo.active { border-color: #ff0099; color: #ff0099; }
.style-btn.btn-gold.active { border-color: #ffd700; color: #ffd700; }

#advanced { display: none; background: rgba(0, 0, 0, 0.05); border: 1px solid var(--border); border-radius: 16px; padding: 20px; margin-top: 24px; animation: fadeSlide 0.3s ease; }
@keyframes fadeSlide { from{opacity:0; transform:translateY(-10px)} to{opacity:1;transform:translateY(0)} }

/* PREVIEW */
.panel.preview { position: sticky; top: 40px; overflow: hidden; padding-top: 20px; }
.view-tabs { display: flex; gap: 12px; margin-bottom: 20px; border-bottom: 1px solid var(--border); padding-bottom: 12px; }
.view-tab { background: none; border: none; color: var(--text-muted); font-weight: 600; padding: 8px 12px; cursor: pointer; position: relative; }
.view-tab.active { color: var(--text-main); }
.view-tab.active::after { content:''; position: absolute; bottom: -13px; left:0; right:0; height: 2px; background: var(--primary); }

/* Standard QR Card */
#previewCardWrapper { width: 100%; aspect-ratio: 1; position: relative; margin-bottom: 20px; display: flex; flex-direction: column; align-items: center; }
#previewCard { width: 100%; height: 100%; background: #fff; border-radius: 24px; display: flex; justify-content: center; align-items: center; box-shadow: 0 20px 50px rgba(0,0,0,0.2); transition: 0.3s; z-index: 2; }
#qrcode { width: 80%; height: 80%; display: flex; justify-content: center; align-items: center; }
.qr-placeholder { color: #94a3b8; font-weight: 700; font-size: 14px; text-align: center; opacity: 0.6; border: 2px dashed #e2e8f0; padding: 20px; border-radius: 12px; width: 80%; height: 80%; display: flex; align-items: center; justify-content: center; }

.framed-container { padding: 25px; border: 10px solid var(--primary); border-radius: 30px; background: #ffffff; box-shadow: 0 10px 30px rgba(0,0,0,0.3); display: flex; flex-direction: column; align-items: center; justify-content: center; }
.frame-label { margin-top: 12px; font-size: 22px; font-weight: 900; text-transform: uppercase; letter-spacing: 3px; color: #000; display:none; }
.framed-container.frame-neon { background: #0f172a; border-color: #39ff14; box-shadow: 0 0 25px rgba(57, 255, 20, 0.5); }
.framed-container.frame-neon .frame-label { color: #39ff14; text-shadow: 0 0 15px rgba(57, 255, 20, 0.8); }
.framed-container.frame-holo { background: #0f172a; border-color: #00f2ea; border-image: linear-gradient(135deg, #00f2ea 0%, #ff0099 100%) 1; box-shadow: 0 0 25px rgba(255, 0, 255, 0.4); }
.framed-container.frame-holo .frame-label { background: linear-gradient(135deg, #00f2ea 0%, #ff0099 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

/* --- üî• ULTRA REALISTIC MOCKUPS --- */
#mockupArea { display: none; width: 100%; height: 420px; margin-bottom: 20px; perspective: 1500px; display:flex; justify-content:center; align-items:center; }

/* 1. iPHONE 15 PRO STYLE */
.device-phone {
    width: 210px; height: 425px;
    background: #000; border-radius: 38px;
    box-shadow: 
        0 0 0 2px #333, /* Inner Frame */
        0 0 0 5px #666, /* Titanium Frame */
        0 30px 60px rgba(0,0,0,0.6);
    position: relative; transform: rotateY(-15deg) rotateX(10deg); transition: 0.5s; overflow: hidden;
}
.device-phone::after { 
    content:''; position:absolute; left:-7px; top:80px; width:4px; height:25px; background:#444; border-radius:2px 0 0 2px; 
    box-shadow: 0 40px 0 #444, 0 80px 0 #444; 
}
.dynamic-island { position: absolute; top: 12px; left: 50%; transform: translateX(-50%); width: 65px; height: 18px; background: #000; border-radius: 20px; z-index: 20; }
.phone-screen { 
    width: 100%; height: 100%; background: url('https://images.unsplash.com/photo-1550684848-fac1c5b4e853?q=80&w=400&auto=format&fit=crop');
    background-size: cover; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative;
}
.phone-glass { position:absolute; inset:0; background:linear-gradient(135deg, rgba(255,255,255,0.15) 0%, transparent 50%); pointer-events:none; z-index:15; border-radius:35px;}
.phone-statusbar { position: absolute; top: 14px; left: 20px; right: 20px; display: flex; justify-content: space-between; color: #fff; font-size: 10px; font-weight: 700; z-index: 9; text-shadow:0 1px 2px rgba(0,0,0,0.5); }
.phone-widget { 
    width: 85%; padding: 20px; background: rgba(255,255,255,0.2); backdrop-filter: blur(15px); 
    border-radius: 24px; border: 1px solid rgba(255,255,255,0.3); box-shadow: 0 15px 35px rgba(0,0,0,0.3); 
    display: flex; flex-direction: column; align-items: center; gap: 10px; transform:translateY(-20px);
}
.phone-bottom-nav { position:absolute; bottom:8px; left:50%; transform:translateX(-50%); width:80px; height:4px; background:#fff; border-radius:2px; opacity:0.6;}

/* 2. NEW PREMIUM BUSINESS CARD */
.device-card {
    width: 340px; height: 200px;
    /* Premium textured background */
    background: linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='0.05'/%3E%3C/svg%3E"), linear-gradient(135deg, #1a1a1a 0%, #2d2d2d 100%);
    border-radius: 16px;
    position: relative;
    transform: rotateX(25deg) rotateY(-10deg) rotateZ(-2deg);
    box-shadow: 20px 30px 50px rgba(0,0,0,0.6);
    transition: 0.5s; overflow: hidden;
    border: 1px solid rgba(255, 215, 0, 0.1); 
}
.device-card::after {
    content: ''; position: absolute; inset: 0;
    background: linear-gradient(115deg, transparent 30%, rgba(255, 215, 0, 0.1) 45%, rgba(255, 255, 255, 0.05) 50%, transparent 60%);
    pointer-events: none;
}
.card-overlay { width: 100%; height: 100%; display: flex; justify-content: space-between; padding: 25px; position: relative; z-index: 2; }
.card-left { display: flex; flex-direction: column; justify-content: space-between; height: 100%; flex: 1; }
.card-right { display: flex; flex-direction: column; align-items: flex-end; justify-content: space-between; height: 100%; }

.card-chip {
    width: 40px; height: 30px; background: linear-gradient(135deg, #e2cba6 0%, #d4af37 100%);
    border-radius: 6px; position: relative; overflow: hidden; border: 1px solid #b8860b;
}
.card-chip::before { content: ''; position: absolute; top: 50%; left: 0; right: 0; height: 1px; background: #b8860b; box-shadow: 0 -8px 0 #b8860b, 0 8px 0 #b8860b; }
.card-chip::after { content: ''; position: absolute; left: 50%; top: 0; bottom: 0; width: 1px; background: #b8860b; box-shadow: -10px 0 0 #b8860b, 10px 0 0 #b8860b; }
.card-contactless { font-size: 24px; color: #d4af37; opacity: 0.8; transform:rotate(90deg); margin-top: 15px;}

.card-text { color: #fff; }
/* Solid Gold Name */
.card-text h4 { margin: 0 0 6px; font-size: 20px; font-weight: 800; letter-spacing: 0.5px; color: #d4af37; }
.card-text p { margin: 0; font-size: 11px; color: #ccc; font-weight: 500; letter-spacing: 1px; }
.card-company { font-size: 10px; font-weight: 700; color: #d4af37; text-transform: uppercase; letter-spacing: 2px; margin-top: auto;}
.mockup-qr-container-card { width: 85px; height: 85px; background: #fff; padding: 5px; border-radius: 10px; box-shadow: 0 5px 15px rgba(0,0,0,0.2); }


/* 3. PURPLE HEXAGONAL BADGE (Corrected Layout) */
.device-badge {
    width: 240px; height: 380px;
    background: #1a1a2e; /* Dark Purple Base */
    border-radius: 16px;
    position: relative;
    box-shadow: 0 20px 60px rgba(0,0,0,0.5);
    display: flex; flex-direction: column; align-items: center;
    overflow: hidden;
    font-family: 'Montserrat', sans-serif;
}
/* White Top Area */
.badge-top-white {
    position: absolute; top: 0; left: 0; right: 0; height: 130px;
    background: #fff;
    clip-path: polygon(0 0, 100% 0, 100% 65%, 50% 100%, 0 65%);
    z-index: 1;
}
/* Purple Ribbons */
.badge-ribbons {
    position: absolute; top: 100px; width: 100%; height: 50px;
    background: #7b2cbf;
    transform: skewY(-10deg);
    z-index: 0;
    opacity: 0.8;
}
.badge-ribbons::after {
    content: ''; position: absolute; top: 10px; width: 100%; height: 30px;
    background: #9d4edd;
    transform: skewY(15deg);
}
/* Company Name Top - Fixed Placement */
.badge-company-top {
    z-index: 2; margin-top: 28px; text-align: center; position: relative;
}
.badge-company-top h4 { margin: 0; color: #1a1a2e; font-weight: 800; font-size: 14px; text-transform: uppercase; letter-spacing: 1px; }
.badge-company-top p { margin: 2px 0 0; color: #7b2cbf; font-size: 8px; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; }

/* Hexagon Photo - Pushed down to clear text */
.badge-photo-hex {
    width: 100px; height: 100px;
    background: #fff;
    z-index: 5; margin-top: 75px; /* Increased margin to push it down */
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    display: flex; justify-content: center; align-items: center;
    background: #7b2cbf; /* Border color via background */
    padding: 4px; /* Border width */
}
.badge-photo-hex img {
    width: 100%; height: 100%; object-fit: cover;
    clip-path: polygon(50% 0%, 100% 25%, 100% 75%, 50% 100%, 0% 75%, 0% 25%);
    background: #fff;
}

/* Name Section */
.badge-name-section { text-align: center; z-index: 5; margin-top: 10px; }
.badge-name-section h2 { margin: 0; font-size: 22px; color: #fff; font-weight: 800; text-transform: uppercase; letter-spacing: 1px; }
.badge-name-section p { margin: 4px 0 0; font-size: 10px; color: #c77dff; font-weight: 600; text-transform: uppercase; letter-spacing: 2px; }

/* Bottom QR Section */
.badge-bottom-qr {
    margin-top: auto; margin-bottom: 25px; z-index: 5;
    background: #fff; padding: 6px; border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    display: flex; flex-direction: column; align-items: center;
}
.badge-bottom-qr img { width: 90px; height: 90px; display: block; }
.badge-id-txt { color: #000; font-size: 9px; font-weight: 700; margin-top: 4px; font-family: 'Roboto Mono', monospace; }

/* Lanyard Hole */
.badge-hole {
    position: absolute; top: 10px; left: 50%; transform: translateX(-50%);
    width: 40px; height: 6px; background: #e0e0e0; border-radius: 10px; z-index: 10;
    box-shadow: inset 0 1px 3px rgba(0,0,0,0.2);
}

/* 4. TABLE MENU (3D Stand) */
.device-tent {
    width: 220px; height: 320px; background: #1a1a1a; position: relative; transform-style: preserve-3d;
    transform: perspective(1200px) rotateX(5deg) rotateY(-25deg);
    box-shadow: 20px 20px 50px rgba(0,0,0,0.5); border-radius: 6px; border:1px solid #333;
}
.device-tent-base {
    position: absolute; bottom: -15px; left: -10px; right: -10px; height: 25px;
    background: #5d4037; border-radius: 4px; transform:translateZ(10px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    border-top: 2px solid #8d6e63;
}
.menu-content { padding:30px 20px; text-align:center; color:#fff; height:100%; display:flex; flex-direction:column; align-items:center; background: url('https://www.transparenttextures.com/patterns/chalkboard.png'); }
.menu-title { font-family: 'Oswald', sans-serif; font-size: 36px; letter-spacing: 2px; margin: 0 0 5px 0; color: #fbbf24; border-bottom: 2px solid #fbbf24; padding-bottom: 5px; }
.mockup-qr-container { width: 110px; height: 110px; background: #fff; padding: 4px; border-radius: 8px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); }
.mockup-qr-container img { width: 100%; height: 100%; display: block; }

/* Filters */
canvas { transition: all 0.5s ease; }
.effect-neon canvas { filter: drop-shadow(0 0 8px rgba(57, 255, 20, 0.6)) contrast(1.2); }
.effect-holo canvas { filter: drop-shadow(0 0 10px rgba(255, 0, 255, 0.5)); animation: holoPulse 3s infinite alternate; }
.effect-metal canvas { filter: grayscale(100%) contrast(140%) brightness(110%) drop-shadow(0 5px 15px rgba(0,0,0,0.4)); }
@keyframes holoPulse { from { filter: hue-rotate(0deg) drop-shadow(0 0 5px cyan); } to { filter: hue-rotate(30deg) drop-shadow(0 0 15px magenta); } }

/* History Panel */
.history-overlay { position: absolute; top: 0; right: 0; bottom: 0; left: 0; background: var(--bg-app); z-index: 50; padding: 24px; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); display: flex; flex-direction: column; border-left:1px solid var(--border); }
.history-overlay.open { transform: translateY(0); }
.history-item { background: var(--input-bg); border: 1px solid var(--border); padding: 12px; border-radius: 10px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
.history-text { font-size: 13px; font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; max-width: 180px; color: var(--text-main); }
.history-date { font-size: 11px; color: var(--text-muted); }
.history-btn-small { padding: 6px 10px; font-size: 10px; text-transform: uppercase; letter-spacing: 0.5px; font-weight: 700; border-radius: 8px; width: auto; border: 1px solid rgba(255,255,255,0.1); }

@media (max-width: 1000px) {
  .app { grid-template-columns: 1fr; }
  .panel.preview { position: static; order: -1; }
  #previewCardWrapper, #mockupArea { width: 300px; margin: 0 auto 20px; }
}
</style>
</head>
<body>

<div class="app">

  <div class="panel">
    
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
      <div class="brand">
        <button class="ghost icon-only" onclick="toggleTheme()" id="themeBtn" title="Toggle Theme">
            <i class="fa-solid fa-moon"></i>
        </button>
        <div class="logo" style="margin-left:12px"><i class="fa-solid fa-qrcode"></i></div>
        <h2>QR CODE GENERATOR</h2>
      </div>
    </div>

    <label>Content</label>
    <textarea id="text" rows="2" placeholder="Paste your URL or text here..." style="resize:none"></textarea>

    <label>Design Style</label>
    <div class="visual-grid">
      <button class="style-btn active" onclick="setStyle('classic', this)">Classic</button>
      <button class="style-btn" onclick="setStyle('rounded', this)">Rounded</button>
      <button class="style-btn" onclick="setStyle('dotted', this)">Dotted</button>
      <button class="style-btn btn-gold" onclick="setStyle('gold', this)">Gold</button>
      <button class="style-btn btn-neon" onclick="setStyle('neon', this)">Neon</button>
      <button class="style-btn btn-holo" onclick="setStyle('holo', this)">Holo</button>
      <button class="style-btn" onclick="setStyle('metal', this)">Metal</button>
      <button class="style-btn" onclick="setStyle('colorful', this)">Vibrant</button>
    </div>
    <input type="hidden" id="designPreset" value="classic">

    <label>Corner Shape</label>
    <div class="visual-grid">
      <button class="style-btn shape-btn active" onclick="setCorner('square', this)">Square</button>
      <button class="style-btn shape-btn" onclick="setCorner('dot', this)">Dot</button>
      <button class="style-btn shape-btn" onclick="setCorner('rounded', this)">Round</button>
      <button class="style-btn shape-btn" onclick="setCorner('extra-rounded', this)">Soft</button>
    </div>
    <input type="hidden" id="cornerShape" value="square">

    <label>Frame & Text</label>
    <div class="row" style="background:var(--input-bg); padding: 8px 12px; border-radius:var(--radius); border:1px solid var(--border);">
        <div style="display:flex; align-items:center; gap:8px; flex:1;">
            <input id="useFrame" type="checkbox" style="width:auto; margin:0;"> 
            <span style="font-size:13px; color:var(--text-muted);">Add Frame</span>
        </div>
        <input id="frameText" type="text" value="SCAN ME" style="flex:1; padding: 8px;" placeholder="Frame text...">
    </div>

    <div class="controls-grid" style="margin-top:16px;">
      <div><label>Dots Color</label><input id="dotsColor" type="color" value="#000000"></div>
      <div><label>Background Color</label><input id="bgColor" type="color" value="#ffffff"></div>
    </div>
    
    <div class="controls-grid">
      <div><label>Resolution</label><input id="size" type="number" min="200" max="2000" value="270"></div>
      <div><label>Logo (Optional)</label><div class="row"><input id="logo" type="file" accept="image/*" style="padding:8px"><input id="logoSize" type="hidden" value="20"></div></div>
    </div>

    <div style="display:flex; gap:12px; margin-top:24px;">
      <button class="primary" onclick="generateQR()">Generate QR Code</button>
      <button class="ghost" onclick="regen()" style="width:140px"><i class="fa fa-rotate-right"></i></button>
    </div>

    <div style="display:flex; gap:12px; margin-top:12px;">
      <button class="ghost" onclick="applyBeautify()"><i class="fa fa-wand-magic-sparkles"></i> AI Beautify</button>
      <button class="ghost" onclick="toggleAdvanced()" id="advBtn">‚öôÔ∏è Export Options</button>
    </div>

    <div id="advanced">
      <h3 class="section-title">Export Settings</h3>
      <div class="controls-grid">
        <div><label>Quiet Zone</label><input id="padding" type="number" min="0" max="80" value="20"></div>
        <div><label>Upscale</label><input id="scale" type="number" value="1" min="1" max="6"></div>
      </div>
      <div style="margin-top:16px; display:flex; align-items:center; gap:8px;">
        <input id="transparent" type="checkbox" style="width:auto; margin:0;"> <span style="font-size:14px; color:var(--text-main);">Transparent Background</span>
      </div>
      <div class="controls-grid" style="margin-top:16px;">
        <div><label>Format</label><select id="format"><option value="png">PNG</option><option value="jpg">JPG</option><option value="svg">SVG</option></select></div>
        <div><label>Filename</label><input id="fileName" type="text" placeholder="my-qrcode"></div>
      </div>
      <button class="primary" onclick="downloadQR()" style="margin-top:16px;">Download File</button>
    </div>

    <div class="panel" id="business" style="margin-top:24px; border:none; background:var(--input-bg); padding:20px;">
      <h3 class="section-title" style="margin:0 0 16px 0; border:none;">Quick Tools & Mockups</h3>
      <div class="controls-grid">
        <button class="ghost" onclick="generateVCard()"><i class="fa fa-address-card"></i> vCard</button>
        <button class="ghost" onclick="generateBadgeData()"><i class="fa fa-id-badge"></i> Badge</button>
        <button class="ghost" onclick="generateMenuData()"><i class="fa fa-utensils"></i> Menu</button>
        <button class="ghost" onclick="generateWiFi()"><i class="fa fa-wifi"></i> WiFi</button>
      </div>
      <div style="margin-top:12px; display:flex; gap:12px;">
        <input id="paymentUrl" type="text" placeholder="URL for Multi-link / Payment">
        <button class="ghost" style="width:auto" onclick="createPayment()">Go</button>
      </div>
    </div>

  </div>

  <div class="panel preview">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h1>Live Preview</h1>
        <button class="ghost history-btn-small" onclick="toggleHistory()">HISTORY</button>
    </div>

    <div class="view-tabs" style="margin-top:16px;">
        <button class="view-tab active" onclick="switchView('standard', this)">Standard View</button>
        <button class="view-tab" onclick="switchView('mockup', this)">Mockup Mode</button>
    </div>
    
    <div id="previewCardWrapper">
        <div id="previewCard">
          <div id="qrcode">
              <div class="qr-placeholder">QR CODE WILL BE GENERATED HERE</div>
          </div>
        </div>
        <div id="frameLabel" class="frame-label" style="display:none;">SCAN ME</div>
    </div>

    <div id="mockupArea" style="display:none;"></div>
    
    <div id="mockupControls" style="display:none;">
        <div class="selection-grid" style="margin-top:16px; grid-template-columns: 1fr 1fr;">
            <button class="select-btn active" onclick="setMockup('phone', this)"><i class="fa-solid fa-mobile-screen"></i> Phone</button>
            <button class="select-btn" onclick="setMockup('card', this)"><i class="fa-solid fa-id-card"></i> Card</button>
            <button class="select-btn" onclick="setMockup('badge', this)"><i class="fa-solid fa-id-badge"></i> Badge</button>
            <button class="select-btn" onclick="setMockup('tent', this)"><i class="fa-solid fa-utensils"></i> Menu</button>
        </div>
        
        <div id="cardTextControls" style="display:none; margin-top:16px; border-top:1px solid var(--border); padding-top:12px;">
            <label style="margin-top:0">Customize Details</label>
            <div class="controls-grid">
                <input id="cardNameInput" type="text" placeholder="Name" value="John Doe" oninput="updateCardText()">
                <input id="cardTitleInput" type="text" placeholder="Title / Role" value="CEO & Founder" oninput="updateCardText()">
            </div>
            <div class="controls-grid" style="margin-top:8px;">
                <input id="cardPhoneInput" type="text" placeholder="Phone / ID" value="+1 234 567 890" oninput="updateCardText()">
                <input id="cardCompanyInput" type="text" placeholder="Company / Institution" value="Acme University" oninput="updateCardText()">
            </div>
            <label style="margin-top:12px">Upload User Photo (for Badge)</label>
            <input id="mockupPhoto" type="file" accept="image/*" style="padding:8px" onchange="handleMockupPhoto(this)">
        </div>
    </div>

    <div class="preview-actions" id="standardActions">
      <button id="downloadBtn" class="primary" onclick="downloadQR()">Download Image</button>
      <button class="ghost" onclick="shareQR()" title="Share"><i class="fa fa-share-nodes"></i></button>
      <button class="ghost" onclick="copyAsImage()" title="Copy to Clipboard"><i class="fa fa-copy"></i></button>
    </div>

    <div style="margin-top:24px; padding-top:16px; border-top:1px solid var(--border);" class="small">
      <div style="display:flex; justify-content:space-between; margin-bottom:4px;">
        <span>Session Views</span>
        <span id="viewCount" style="color:var(--text-main)">0</span>
      </div>
      <div style="display:flex; justify-content:space-between;">
        <span>Downloads</span>
        <span id="downloadCount" style="color:var(--text-main)">0</span>
      </div>
    </div>

    <div id="historyOverlay" class="history-overlay">
      <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
        <h3 style="margin:0; font-size:16px;">Recent Designs</h3>
        <button class="ghost history-btn-small" onclick="toggleHistory()">CLOSE</button>
      </div>
      <div id="historyList" style="overflow-y:auto; flex:1;"></div>
      <button class="warn" onclick="clearHistory()" style="margin-top:12px;">Clear All</button>
    </div>

  </div>

</div>

<script>
/* ---------------- State ---------------- */
let qr = null;
let lastBlob = null;
const analyticsKey = 'ultimate_qr_analytics_v1';
const historyKey = 'ultimate_qr_history_log';
let analytics = { views:0, downloads:0 };
let currentMockup = 'phone';
let currentView = 'standard';
let userPhotoURL = null;
let currentTheme = localStorage.getItem('ultimate_qr_theme') || 'dark';

/* Init Theme */
if(currentTheme === 'light') document.documentElement.setAttribute('data-theme', 'light');

/* Load analytics */
try {
  const a = JSON.parse(localStorage.getItem(analyticsKey) || '{}');
  analytics = { views: a.views||0, downloads: a.downloads||0 };
  document.getElementById('viewCount').innerText = analytics.views;
  document.getElementById('downloadCount').innerText = analytics.downloads;
} catch(e){ console.warn(e); }

/* Helpers */
const $ = id => document.getElementById(id);
function readFileAsDataURL(file){ return new Promise((res,rej)=>{ const r=new FileReader(); r.onload=()=>res(r.result); r.onerror=rej; r.readAsDataURL(file); }); }
function downloadBlob(blob, filename){ const url=URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download=filename; document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url); }

function waitForCanvas(timeout = 2500) {
  return new Promise((resolve,reject) => {
    const start = Date.now();
    const check = () => {
      const canvas = $('qrcode').querySelector('canvas');
      if (canvas) return resolve(canvas);
      if (Date.now() - start > timeout) return reject(new Error('Canvas not found'));
      setTimeout(check, 100);
    };
    check();
  });
}

/* ---------------- Theme Toggle ---------------- */
function toggleTheme() {
    const root = document.documentElement;
    const icon = $('themeBtn').querySelector('i');
    if (root.getAttribute('data-theme') === 'light') {
        root.removeAttribute('data-theme');
        localStorage.setItem('ultimate_qr_theme', 'dark');
        icon.className = 'fa-solid fa-moon';
    } else {
        root.setAttribute('data-theme', 'light');
        localStorage.setItem('ultimate_qr_theme', 'light');
        icon.className = 'fa-solid fa-sun';
    }
}

/* ---------------- Generate QR ---------------- */
async function generateQR(){
  const text = $('text').value.trim();
  if(!text){ alert('Enter text or URL'); return; }

  const size = parseInt($('size').value) || 270; 
  let preset = $('designPreset').value;
  let corner = $('cornerShape').value;
  let dots = $('dotsColor').value;
  let bg = $('transparent') && $('transparent').checked ? 'transparent' : $('bgColor').value;
  const useFrame = $('useFrame').checked;
  const frameTxt = $('frameText').value;

  let isHolo = preset === 'holo';
  let isNeon = preset === 'neon';
  let isMetal = preset === 'metal';

  if(isNeon) { bg = '#0f172a'; dots = '#ffffff'; }
  if(isHolo) { dots = '#000000'; bg = '#0f172a'; }

  const options = {
    width: size, height: size,
    data: text,
    qrOptions: { errorCorrectionLevel: 'H' }, 
    dotsOptions: { color: dots, type: 'square' },
    backgroundOptions: { color: bg },
    cornersSquareOptions: { color: dots, type: 'square' },
    cornersDotOptions: { color: dots, type: 'square' },
    imageOptions: { crossOrigin: 'anonymous', margin: parseInt($('padding').value)||0, hideBackgroundDots: true }
  };

  if(preset === 'dotted') {
      options.dotsOptions.type = 'dots';
      options.cornersSquareOptions.type = 'dot';
      options.cornersDotOptions.type = 'dot';
  } else if (preset === 'rounded') {
      options.dotsOptions.type = 'rounded';
  } else if (preset === 'gold') {
      options.dotsOptions.color = '#b78b00'; 
      options.cornersSquareOptions.color = '#b78b00';
      options.cornersDotOptions.color = '#b78b00';
  } else if (preset === 'colorful') {
     options.dotsOptions.gradient = { type: 'linear', rotation: 45, colorStops: [{ offset: 0, color: '#6366f1' }, { offset: 1, color: '#ec4899' }] };
  }

  if(preset === 'dotted') {
      if(corner !== 'square') applyCornerLogic(corner, options, preset);
  } else {
      applyCornerLogic(corner, options, preset);
  }

  if(isNeon){
      const neonGreen = '#39ff14';
      options.cornersSquareOptions.color = neonGreen; options.cornersDotOptions.color = neonGreen; options.dotsOptions.color = '#ffffff'; 
  }
  if(isHolo){
    options.dotsOptions.type = 'extra-rounded';
    options.dotsOptions.gradient = { type: 'linear', rotation: 45, colorStops: [{ offset: 0, color: '#00f2ea' }, { offset: 1, color: '#ff0099' }] };
    options.cornersSquareOptions.color = '#00f2ea'; options.cornersDotOptions.color = '#ff0099';
  }

  const logoFile = $('logo').files[0];
  if(logoFile){
    const logoUrl = await readFileAsDataURL(logoFile);
    options.image = logoUrl;
    options.imageOptions = { crossOrigin: 'anonymous', imageSize: 0.2, margin: 5, hideBackgroundDots: true };
  }

  const container = $('qrcode');
  container.innerHTML = '';

  try {
    qr = new QRCodeStyling(options);
    qr.append(container);
  } catch(err){ console.error(err); alert('QR library init failed.'); return; }

  let canvas;
  try {
    canvas = await waitForCanvas(3000);
  } catch(e){
    await new Promise(r => setTimeout(r, 500));
    canvas = $('qrcode').querySelector('canvas');
  }

  // Apply Effects & Frame to Preview
  const previewCard = $('previewCard');
  const frameLabel = $('frameLabel');
  const wrapper = $('previewCardWrapper');
  
  previewCard.className = ''; // reset effects
  wrapper.className = ''; // reset frame
  frameLabel.style.display = 'none';

  if(canvas) {
    if(isNeon) previewCard.classList.add('effect-neon');
    if(isHolo) previewCard.classList.add('effect-holo');
    if(isMetal) previewCard.classList.add('effect-metal');

    if(useFrame){
        wrapper.classList.add('framed-container');
        wrapper.classList.remove('frame-neon', 'frame-holo');
        wrapper.style.borderColor = '';
        wrapper.style.background = ''; 
        frameLabel.style.color = '';

        if(isNeon) {
            wrapper.classList.add('frame-neon');
        } else if(isHolo) {
            wrapper.classList.add('frame-holo');
        } else {
            wrapper.style.borderColor = dots;
            wrapper.style.background = '#ffffff'; 
            frameLabel.style.color = dots;
        }

        frameLabel.innerText = frameTxt || 'SCAN ME';
        frameLabel.style.display = 'block';
    }
    if(currentView === 'mockup') renderMockup(currentMockup);
  }

  try { lastBlob = await qr.getRawData('png'); } catch(err){ lastBlob = null; }
  analytics.views = (analytics.views || 0) + 1;
  localStorage.setItem(analyticsKey, JSON.stringify(analytics));
  $('viewCount').innerText = analytics.views;
  
  if(!isHolo && !isNeon) addToHistory(text);
}

function applyCornerLogic(corner, options, preset) {
  if(corner === 'dot') { options.cornersSquareOptions.type = 'dot'; options.cornersDotOptions.type = 'dot'; } 
  else if(corner === 'rounded') { options.cornersSquareOptions.type = 'extra-rounded'; options.cornersDotOptions.type = 'dot'; } 
  else if(corner === 'extra-rounded') { options.cornersSquareOptions.type = 'extra-rounded'; options.cornersDotOptions.type = 'square'; if(preset !== 'dotted') options.dotsOptions.type = 'classy'; } 
  else { options.cornersSquareOptions.type = 'square'; options.cornersDotOptions.type = 'square'; }
}

/* View Switching & Mockups */
function switchView(view, btn){
    currentView = view;
    document.querySelectorAll('.view-tab').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const dlBtn = $('downloadBtn');

    if(view === 'standard'){
        $('previewCardWrapper').style.display = 'flex';
        $('mockupArea').style.display = 'none';
        $('mockupControls').style.display = 'none'; 
        dlBtn.innerText = 'Download Image';
        dlBtn.onclick = downloadQR;
    } else {
        $('previewCardWrapper').style.display = 'none';
        $('mockupArea').style.display = 'flex'; 
        $('mockupControls').style.display = 'block'; 
        dlBtn.innerText = 'Download Mockup';
        dlBtn.onclick = downloadMockup;
        renderMockup(currentMockup);
    }
}

function setMockup(type, btn){
    currentMockup = type;
    if(type === 'card' || type === 'badge') $('cardTextControls').style.display = 'block';
    else $('cardTextControls').style.display = 'none';

    renderMockup(type);
    btn.parentElement.querySelectorAll('.select-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
}

function handleMockupPhoto(input) {
    if(input.files && input.files[0]){
        readFileAsDataURL(input.files[0]).then(url => {
            userPhotoURL = url;
            updateCardText(); // trigger render
        });
    }
}

function updateCardText() {
    if(currentView === 'mockup' && (currentMockup === 'card' || currentMockup === 'badge')) {
        renderMockup(currentMockup);
    }
}

function renderMockup(type){
    const canvas = $('qrcode').querySelector('canvas');
    if(!canvas) return;
    const dataUrl = canvas.toDataURL();
    const area = $('mockupArea');
    
    const name = $('cardNameInput').value || 'John Doe';
    const title = $('cardTitleInput').value || 'CEO & Founder';
    const phone = $('cardPhoneInput').value || '+1 234 567 890';
    const company = $('cardCompanyInput').value || 'Acme University';
    
    let photoHTML = `<i class="fa-solid fa-user fa-2x" style="color:white;"></i>`;
    if(userPhotoURL) { photoHTML = `<img src="${userPhotoURL}">`; }

    if(type === 'phone'){
        area.innerHTML = `
            <div id="captureMockup" style="display:flex;justify-content:center;align-items:center;height:100%"><div class="device-phone">
                <div class="dynamic-island"></div>
                <div class="phone-glass"></div>
                <div class="phone-statusbar"><span>9:41</span><span><i class="fa fa-wifi"></i> <i class="fa fa-battery-full"></i></span></div>
                <div class="phone-screen">
                    <div class="phone-widget">
                        <div class="phone-widget-title">SCAN ME</div>
                        <img src="${dataUrl}" style="width:100%; display:block;">
                    </div>
                    <div class="phone-bottom-nav"></div>
                </div>
            </div></div>`;
    } else if(type === 'card') {
        area.innerHTML = `
            <div id="captureMockup" style="display:flex;justify-content:center;align-items:center;height:100%"><div class="device-card">
                <div class="card-overlay">
                    <div class="card-left">
                        <div>
                             <div class="card-chip"></div>
                             <div class="card-contactless"><i class="fa-solid fa-wifi"></i></div>
                        </div>
                        <div class="card-text">
                            <h4>${name}</h4>
                            <p>${title}</p>
                            <p style="margin-top:8px; font-family:'Roboto Mono', monospace; letter-spacing:2px; opacity:0.8;">${phone}</p>
                        </div>
                    </div>
                    <div class="card-right">
                        <div class="mockup-qr-container-card">
                            <img src="${dataUrl}" style="width:100%; display:block;">
                        </div>
                        <p class="card-company">${company}</p>
                    </div>
                </div>
            </div></div>`;
    } else if(type === 'badge') {
        area.innerHTML = `
            <div id="captureMockup" style="display:flex;justify-content:center;align-items:center;height:100%"><div class="device-badge">
                <div class="badge-hole"></div>
                <div class="badge-top-white">
                    <div class="badge-company-top">
                        <h4>${company}</h4>
                        <p>OFFICIAL ID</p>
                    </div>
                </div>
                <div class="badge-ribbons"></div>
                <div class="badge-photo-hex">
                    ${photoHTML}
                </div>
                
                <div class="badge-name-section">
                    <h2>${name}</h2>
                    <p>${title}</p>
                </div>

                <div class="badge-bottom-qr">
                    <img src="${dataUrl}">
                    <div class="badge-id-txt">${phone}</div>
                </div>
            </div></div>`;
    } else if(type === 'tent') {
        area.innerHTML = `
            <div id="captureMockup" style="display:flex;justify-content:center;align-items:center;height:100%"><div class="device-tent">
                <div class="device-tent-base"></div>
                <div class="menu-content">
                    <h2 class="menu-title">MENU</h2>
                    <p style="font-family:'Playfair Display', serif; color:#ddd; font-style:italic; margin-bottom:30px;">Scan for today's specials</p>
                    <div class="mockup-qr-container" style="border:4px solid #fff; box-shadow:0 5px 15px rgba(0,0,0,0.5);">
                        <img src="${dataUrl}" style="width:100%; display:block;">
                    </div>
                    <div style="margin-top:auto; font-size:10px; color:#aaa;">Free Wi-Fi Available</div>
                </div>
            </div></div>`;
    }
}

/* Style Selectors */
function setStyle(val, btn){
  $('designPreset').value = val;
  const siblings = btn.parentElement.children;
  for(let i=0; i<siblings.length; i++) siblings[i].classList.remove('active');
  btn.classList.add('active');
  if(val === 'dotted') { $('cornerShape').value = 'dot'; updateShapeBtns(); }
  generateQR();
}

function setCorner(val, btn){
  $('cornerShape').value = val;
  updateShapeBtns();
  generateQR();
}

function updateShapeBtns(){
    const val = $('cornerShape').value;
    const btns = document.querySelectorAll('.shape-btn');
    btns.forEach(b => {
       const txt = b.innerText.toLowerCase();
       let match = false;
       if (val==='square' && txt==='square') match=true;
       if (val==='dot' && txt==='dot') match=true;
       if (val==='rounded' && txt==='round') match=true;
       if (val==='extra-rounded' && txt==='soft') match=true;
       if(match) b.classList.add('active'); else b.classList.remove('active');
    });
}

/* History (Same) */
function addToHistory(text){ const item = { text: text, date: new Date().toLocaleTimeString() }; let history = JSON.parse(localStorage.getItem(historyKey) || '[]'); if(history.length > 0 && history[0].text === text) return; history.unshift(item); localStorage.setItem(historyKey, JSON.stringify(history)); updateHistoryUI(); }
function updateHistoryUI(){ const history = JSON.parse(localStorage.getItem(historyKey) || '[]'); const list = $('historyList'); list.innerHTML = ''; history.slice(0, 50).forEach((h, index) => { const div = document.createElement('div'); div.className = 'history-item'; div.innerHTML = ` <div style="overflow:hidden"> <div class="history-text" title="${h.text}">${h.text}</div> <div class="history-date">${h.date}</div> </div> <div style="display:flex; gap:6px;"> <button class="ghost" style="width:auto; padding:6px 10px;" onclick="loadFromHistory('${h.text}')"> <i class="fa fa-arrow-up-right-from-square"></i> </button> <button class="warn" style="width:auto; padding:6px 10px;" onclick="deleteHistoryItem(${index})"> <i class="fa fa-trash"></i> </button> </div> `; list.appendChild(div); }); }
function loadFromHistory(txt){ $('text').value = txt; generateQR(); }
function deleteHistoryItem(idx){ let history = JSON.parse(localStorage.getItem(historyKey) || '[]'); history.splice(idx, 1); localStorage.setItem(historyKey, JSON.stringify(history)); updateHistoryUI(); }
function clearHistory(){ if(confirm('Clear all history?')){ localStorage.removeItem(historyKey); updateHistoryUI(); } }
function toggleHistory(){ $('historyOverlay').classList.toggle('open'); updateHistoryUI(); }

/* Download Standard */
async function downloadQR(){
  if(!qr && !lastBlob){ alert('Generate a QR first'); return; }
  const fmt = $('format').value || 'png';
  const scale = parseInt($('scale').value) || 1;
  const name = (($('fileName').value || 'qr-code').trim()).replace(/\s+/g,'-');
  try {
    const img = new Image();
    const baseBlob = lastBlob || await qr.getRawData('png');
    img.onload = () => {
      const canvas = document.createElement('canvas');
      canvas.width = img.width * scale;
      canvas.height = img.height * scale;
      const ctx = canvas.getContext('2d');
      let preset = $('designPreset').value;
      if(fmt === 'jpg' || !$('transparent').checked || preset === 'holo' || preset === 'neon') { 
        ctx.fillStyle = $('bgColor').value; 
        if(preset==='holo' || preset==='neon') ctx.fillStyle = '#0f172a'; 
        ctx.fillRect(0,0,canvas.width,canvas.height); 
      }
      if(preset === 'neon') ctx.filter = 'drop-shadow(0 0 15px rgba(57, 255, 20, 0.6)) contrast(1.2)';
      if(preset === 'holo') ctx.filter = 'hue-rotate(90deg) contrast(1.2) brightness(1.1)';
      if(preset === 'metal') ctx.filter = 'grayscale(100%) contrast(140%) brightness(110%)';
      
      ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
      canvas.toBlob(b => { downloadBlob(b, name + '.' + fmt); analytics.downloads++; gotoSaveAnalytics(); }, fmt==='jpg'?'image/jpeg':'image/png');
    };
    img.src = URL.createObjectURL(baseBlob);
  } catch(e){ alert('Download failed'); }
}

/* Download Mockup (html2canvas) */
async function downloadMockup(){
    const element = document.getElementById('captureMockup');
    if(!element) return;
    try {
        const canvas = await html2canvas(element, { backgroundColor: null, scale: 2 });
        const link = document.createElement('a');
        link.download = 'qr-mockup.png';
        link.href = canvas.toDataURL('image/png');
        link.click();
        analytics.downloads++; gotoSaveAnalytics();
    } catch(e) { console.error(e); alert('Mockup generation failed.'); }
}

function gotoSaveAnalytics(){ localStorage.setItem(analyticsKey, JSON.stringify(analytics)); $('downloadCount').innerText = analytics.downloads; }

/* GENERATORS (Updated Logic) */
function generateVCard(){ 
    const fn = prompt('Full name:'); if(!fn) return; 
    const tel = prompt('Phone:'); 
    const email = prompt('Email:'); 
    const v = `BEGIN:VCARD\nVERSION:3.0\nFN:${fn}\nTEL:${tel}\nEMAIL:${email}\nEND:VCARD`; 
    $('text').value = v; 
    generateQR().then(() => {
        switchView('mockup', document.querySelectorAll('.view-tab')[1]);
        setMockup('card', document.querySelector('.select-btn:nth-child(2)'));
        $('cardNameInput').value = fn;
        $('cardTitleInput').value = "Business Owner";
        $('cardPhoneInput').value = tel || email;
        updateCardText();
    }); 
}

function generateBadgeData(){ 
    const fn = prompt('Employee Name:'); if(!fn) return; 
    const role = prompt('Role / Title:'); 
    const num = prompt('Employee ID / Phone:'); 
    const comp = prompt('Company / Institution:');
    
    $('text').value = `Name: ${fn}\nRole: ${role}\nID: ${num}`; 
    generateQR().then(() => {
        switchView('mockup', document.querySelectorAll('.view-tab')[1]);
        setMockup('badge', document.querySelector('.select-btn:nth-child(3)'));
        $('cardNameInput').value = fn;
        $('cardTitleInput').value = role;
        $('cardPhoneInput').value = num;
        $('cardCompanyInput').value = comp;
        updateCardText();
    });
}

function generateMenuData(){ 
    const url = prompt('Menu URL (PDF or Link):'); if(!url) return;
    $('text').value = url;
    generateQR().then(() => {
        switchView('mockup', document.querySelectorAll('.view-tab')[1]);
        setMockup('tent', document.querySelector('.select-btn:nth-child(4)'));
    });
}

function generateWiFi(){ const ssid = prompt('SSID:'); if(!ssid) return; const p = prompt('Password:'); $('text').value = `WIFI:T:WPA;S:${ssid};P:${p};;`; generateQR().then(() => { switchView('mockup', document.querySelectorAll('.view-tab')[1]); setMockup('phone', document.querySelector('.select-btn:first-child')); }); }
function createPayment(){ const u=$('paymentUrl').value; if(u) {$('text').value=u; generateQR();} }
function regen(){ if(meta.text){ $('text').value = meta.text; generateQR(); } else generateQR(); }
function applyBeautify(){ const txt = $('text').value || ''; if(txt.includes('http')){ setStyle('colorful', document.querySelector('.style-btn:last-child')); } else { setStyle('rounded', document.querySelector('.style-btn:nth-child(2)')); } }
function toggleAdvanced(){ const adv = $('advanced'); const btn = $('advBtn'); if(adv.style.display === 'block'){ adv.style.display = 'none'; btn.innerHTML = '‚öôÔ∏è Export Options'; btn.classList.add('ghost'); } else { adv.style.display = 'block'; btn.innerHTML = 'üîº Hide'; btn.classList.remove('ghost'); } }
document.addEventListener('keydown', function(e) { if (e.key === 'Enter') { const active = document.activeElement; if (!active) return; if (active.id === 'text' && !e.shiftKey) { e.preventDefault(); generateQR(); } else if (['size', 'dotsColor', 'bgColor', 'logoSize', 'padding', 'border', 'scale', 'frameText'].includes(active.id)) { generateQR(); } else if (active.id === 'fileName') { downloadQR(); } else if (active.id === 'paymentUrl') { createPayment(); } } });
$('useFrame').addEventListener('change', generateQR);

/* Init */
updateHistoryUI();
</script>
</body>
</html>